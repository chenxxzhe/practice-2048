!function(Q){function F(U){if(B[U])return B[U].exports;var I=B[U]={i:U,l:!1,exports:{}};return Q[U].call(I.exports,I,I.exports,F),I.l=!0,I.exports}var B={};F.m=Q,F.c=B,F.i=function(Q){return Q},F.d=function(Q,B,U){F.o(Q,B)||Object.defineProperty(Q,B,{configurable:!1,enumerable:!0,get:U})},F.n=function(Q){var B=Q&&Q.__esModule?function(){return Q.default}:function(){return Q};return F.d(B,"a",B),B},F.o=function(Q,F){return Object.prototype.hasOwnProperty.call(Q,F)},F.p="",F(F.s=2)}([function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar game = {\n    // 游戏面板显示的数字， 一维数组储存\n    mat: [],\n    emptyTiles: [],\n    score: 0,\n    best: 0,\n    LEFT: 0,\n    DOWN: 1,\n    RIGHT: 2,\n    UP: 3,\n    // 历史状态记录，保存三条\n    _history: {\n        mat: [],\n        score: [],\n        best: []\n    },\n    // 上一步状态记录\n    _last: {\n        mat: [],\n        score: 0,\n        best: 0\n    },\n    _started: false,\n    _noNewNum: false,\n    onStart: null,\n    onMove: null,\n    onEmerge: null,\n    onGenNewNum: null,\n    onScore: null,\n    onGameOver: null\n};\n\nfunction reset(resetBest) {\n    game.mat = null;\n    game.emptyTiles = [];\n    game._started = false;\n    game.score = 0;\n    if (resetBest) {\n        game.best = 0;\n    }\n    game._history = {\n        mat: [],\n        score: [],\n        best: []\n    };\n    game._last = {\n        mat: [],\n        score: 0,\n        best: game.best\n    };\n    game._noNewNum = false;\n\n    if (isFunction(game.onScore)) {\n        game.onScore();\n    }\n}\n\nfunction initMat() {\n    game.mat = createFilledArr(0, 16);\n\n    updateEmptyTiles();\n\n    for (var i = 0, l = 2; i < l; i++) {\n        genNumInEmpty();\n    }\n}\n\nfunction updateEmptyTiles() {\n    game.emptyTiles = [];\n    game.mat.forEach(function (v, i) {\n        if (v === 0) {\n            game.emptyTiles.push(i);\n        }\n    });\n}\n\nfunction genNumInEmpty(pos) {\n    if (game._noNewNum) return false;\n    updateEmptyTiles();\n    var position;\n    if (pos) {\n        position = pos;\n    } else {\n        var randint = Math.floor(Math.random() * game.emptyTiles.length);\n        position = game.emptyTiles[randint];\n    }\n    var posIndex = game.emptyTiles.indexOf(position);\n    if (game.mat[position] || posIndex === -1) {\n        return false;\n    }\n\n    game.mat[position] = choice([2, 4]);\n    if (isFunction(game.onGenNewNum)) {\n        game.onGenNewNum(game.mat[position], position);\n    }\n    game.emptyTiles.splice(posIndex, 1);\n    return true;\n}\n\n// 开始新游戏\nfunction newGame(resetBest) {\n    reset(resetBest);\n    game._started = true;\n    initMat();\n    if (isFunction(game.onStart)) {\n        game.onStart();\n    }\n}\n\n// 得分\nfunction score(v) {\n    game.score += v;\n    game.best = Math.max(game.score, game.best);\n    if (isFunction(game.onScore)) {\n        game.onScore();\n    }\n}\n\n// 只有当没有空格，并且任意相邻的两格不相同才是gameOver\nfunction isGameOver() {\n    if (game.emptyTiles.length > 0) return false;\n    // 对每个位置只查右下两格是否相等\n    var flag = true;\n    for (var i = 0, l = 16; i < l; i++) {\n        if (Math.floor(i / 4) === 3) {\n            // 最后一行，最后一个\n            if (i % 4 === 3) continue;\n            if (game.mat[i] === game.mat[i + 1]) {\n                flag = false;\n                break;\n            }\n        } else if (i % 4 === 3) {\n            if (game.mat[i] === game.mat[i + 4]) {\n                flag = false;\n                break;\n            }\n        } else if (game.mat[i] === game.mat[i + 1] || game.mat[i] === game.mat[i + 4]) {\n            flag = false;\n            break;\n        }\n    }\n    return flag;\n}\n\n// 游戏结束\nfunction gameOver() {\n    // reset();\n    game._started = false;\n    if (isFunction(game.onGameOver)) {\n        game.onGameOver();\n    }\n}\n\n// 回撤三步\nfunction undo() {\n    if (!game._started) return false;\n    var history = game._history;\n    if (!history || history.mat.length === 0) {\n        return false;\n    }\n    game.mat = history.mat.pop();\n    game.score = history.score.pop();\n    game.best = history.best.pop();\n    if (isFunction(game.onScore)) {\n        game.onScore();\n    }\n\n    var last = game._last;\n    last.mat = game.mat.slice();\n    last.score = game.score;\n    last.best = game.best;\n    return true;\n}\n\n// 记录状态，用于undo\nfunction record() {\n    var last = game._last;\n    var hist = game._history;\n    // remember into history\n    if (last.mat.length !== 0) {\n        hist.mat.push(last.mat.slice());\n        hist.score.push(last.score);\n        hist.best.push(last.best);\n    }\n    if (hist.mat.length > 3) {\n        hist.mat.shift();\n        hist.score.shift();\n        hist.best.shift();\n    }\n    // record this step\n    last.mat = game.mat.slice();\n    last.score = game.score;\n    last.best = game.best;\n}\n\nfunction move(direction) {\n    if (!game._started) {\n        return;\n    }\n    var last = game.mat.slice();\n\n    // 先移动再判断是否有效移动或者GAME OVER\n    switch (direction) {\n        case game.RIGHT:\n            clockwiseTransform(game.mat);\n            clockwiseTransform(game.mat);\n            mergeToLeft(game.mat, onMove, onEmerge);\n            clockwiseTransform(game.mat);\n            clockwiseTransform(game.mat);\n            break;\n        case game.UP:\n            clockwiseTransform(game.mat, true);\n            mergeToLeft(game.mat, onMove, onEmerge);\n            clockwiseTransform(game.mat);\n            break;\n        case game.DOWN:\n            clockwiseTransform(game.mat);\n            mergeToLeft(game.mat, onMove, onEmerge);\n            clockwiseTransform(game.mat, true);\n            break;\n        case game.LEFT:\n            mergeToLeft(game.mat, onMove, onEmerge);\n            break;\n    }\n\n    // 首先检查是否有效移动\n    if (last.toString() === game.mat.toString()) {\n        // 然后检查emptyTiles还有没有元素\n        if (isGameOver()) {\n            // 无空格就gameOver\n            gameOver();\n        }\n        // 无效移动不做任何事。\n    } else {\n        genNumInEmpty();\n        record();\n    }\n\n    function onMove(v, newPos, lastPos) {\n        if (isFunction(game.onMove)) {\n            game.onMove(v, getOriginIndex(direction, newPos), getOriginIndex(direction, lastPos));\n        }\n    }\n\n    function onEmerge(v, newPos, lastPos) {\n        if (isFunction(game.onEmerge)) {\n            game.onEmerge(v, getOriginIndex(direction, newPos), getOriginIndex(direction, lastPos));\n        }\n    }\n}\n\n// 合并格子\nfunction mergeToLeft(matrix, onMove, onEmerge) {\n    var block = 0;\n    var mergeToNext = function mergeToNext(v, i) {\n        if (i % 4 === 0 || v === 0) {\n            return;\n        }\n        if (matrix[i - 1] === 0) {\n            matrix[i - 1] = v;\n            matrix[i] = 0;\n            // 移动后的回调\n            // 由于转置过，导致索引不对，因此要转置回去\n            // XXX: 应该有更好的处理方法\n            onMove(v, i - 1, i);\n            return mergeToNext(v, i - 1);\n        } else if (i === block) {\n            return;\n        } else if (matrix[i - 1] === v) {\n            matrix[i - 1] += v;\n            matrix[i] = 0;\n            // 避免一次移动中同一格多次合并\n            block = i;\n            // 合并的回调\n            onEmerge(matrix[i - 1], i - 1, i);\n            score(matrix[i - 1]);\n            return;\n        }\n    };\n\n    matrix.forEach(function (v, i) {\n        mergeToNext(v, i);\n    });\n}\n\n// 由转置后的索引映射到原本的索引\nfunction getOriginIndex(clockwiseTimes, index) {\n    var pos,\n        lastIndex = index;\n    for (var i = 0, l = clockwiseTimes; i < l; i++) {\n        pos = index2RowCol(lastIndex);\n        lastIndex = rowCol2Index(3 - pos.col, pos.row);\n    }\n    return lastIndex;\n}\n\nfunction clockwiseTransform(matrix, reverse) {\n    var temp = matrix.slice();\n    if (reverse) {\n        temp.forEach(function (v, i) {\n            var pos = index2RowCol(i),\n                newPos = rowCol2Index(3 - pos.col, pos.row);\n            matrix[newPos] = v;\n        });\n    } else {\n        temp.forEach(function (v, i) {\n            var pos = index2RowCol(i),\n                newPos = rowCol2Index(pos.col, 3 - pos.row);\n            matrix[newPos] = v;\n        });\n    }\n}\n\n// 一维数组的索引转为行列\nfunction index2RowCol(index) {\n    return {\n        row: Math.floor(index / 4),\n        col: index % 4\n    };\n}\n\n// 行列转为一维数组索引\nfunction rowCol2Index(row, col) {\n    return row * 4 + col;\n}\n\n// 使用行列来获取一维数组的值\nfunction getMatValByRowCol(mat, row, col) {\n    var index = rowCol2Index(row, col);\n    return mat[index];\n}\n\n// console\nfunction print() {\n    var str = '';\n    game.mat.forEach(function (v, i) {\n        str += (v || 0) + '\\t';\n        if (i % 4 === 3) {\n            str += '\\n';\n        }\n    });\n    return str;\n}\n\n// util\nfunction createFilledArr(data, size) {\n    var arr = [];\n    arr.length = size;\n    return arr.join(',').split(',').map(function () {\n        return data;\n    });\n}\n\nfunction choice(opts) {\n    var randomIndex = Math.floor(opts.length * Math.random());\n    return opts[randomIndex];\n}\n\nfunction isFunction(obj) {\n    return typeof obj === 'function';\n}\n\ngame.move = move;\ngame.print = print;\ngame.createFilledArr = createFilledArr;\ngame.index2RowCol = index2RowCol;\ngame.rowCol2Index = rowCol2Index;\ngame.getMatValByRowCol = getMatValByRowCol;\ngame.genNumInEmpty = genNumInEmpty;\ngame.newGame = newGame;\ngame.reset = reset;\ngame.undo = undo;\ngame.isGameOver = isGameOver;\ngame.gameOver = gameOver;\n\nexports.default = game;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvZ2FtZS5qcz82Yjk4Il0sIm5hbWVzIjpbImdhbWUiLCJtYXQiLCJlbXB0eVRpbGVzIiwic2NvcmUiLCJiZXN0IiwiTEVGVCIsIkRPV04iLCJSSUdIVCIsIlVQIiwiX2hpc3RvcnkiLCJfbGFzdCIsIl9zdGFydGVkIiwiX25vTmV3TnVtIiwib25TdGFydCIsIm9uTW92ZSIsIm9uRW1lcmdlIiwib25HZW5OZXdOdW0iLCJvblNjb3JlIiwib25HYW1lT3ZlciIsInJlc2V0IiwicmVzZXRCZXN0IiwiaXNGdW5jdGlvbiIsImluaXRNYXQiLCJjcmVhdGVGaWxsZWRBcnIiLCJ1cGRhdGVFbXB0eVRpbGVzIiwiaSIsImwiLCJnZW5OdW1JbkVtcHR5IiwiZm9yRWFjaCIsInYiLCJwdXNoIiwicG9zIiwicG9zaXRpb24iLCJyYW5kaW50IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibGVuZ3RoIiwicG9zSW5kZXgiLCJpbmRleE9mIiwiY2hvaWNlIiwic3BsaWNlIiwibmV3R2FtZSIsIm1heCIsImlzR2FtZU92ZXIiLCJmbGFnIiwiZ2FtZU92ZXIiLCJ1bmRvIiwiaGlzdG9yeSIsInBvcCIsImxhc3QiLCJzbGljZSIsInJlY29yZCIsImhpc3QiLCJzaGlmdCIsIm1vdmUiLCJkaXJlY3Rpb24iLCJjbG9ja3dpc2VUcmFuc2Zvcm0iLCJtZXJnZVRvTGVmdCIsInRvU3RyaW5nIiwibmV3UG9zIiwibGFzdFBvcyIsImdldE9yaWdpbkluZGV4IiwibWF0cml4IiwiYmxvY2siLCJtZXJnZVRvTmV4dCIsImNsb2Nrd2lzZVRpbWVzIiwiaW5kZXgiLCJsYXN0SW5kZXgiLCJpbmRleDJSb3dDb2wiLCJyb3dDb2wySW5kZXgiLCJjb2wiLCJyb3ciLCJyZXZlcnNlIiwidGVtcCIsImdldE1hdFZhbEJ5Um93Q29sIiwicHJpbnQiLCJzdHIiLCJkYXRhIiwic2l6ZSIsImFyciIsImpvaW4iLCJzcGxpdCIsIm1hcCIsIm9wdHMiLCJyYW5kb21JbmRleCIs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Q0E1QyxLQUFLOEMsUUFBTCxHQUFnQkEsUUFBaEI7O2tCQUdlOUMsSSIsImZpbGUiOiIwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG52YXIgZ2FtZSA9IHtcbiAgICAvLyDmuLjmiI/pnaLmnb/mmL7npLrnmoTmlbDlrZfvvIwg5LiA57u05pWw57uE5YKo5a2YXG4gICAgbWF0OiBbXSxcbiAgICBlbXB0eVRpbGVzOiBbXSxcbiAgICBzY29yZTogMCxcbiAgICBiZXN0OiAwLFxuICAgIExFRlQ6IDAsXG4gICAgRE9XTjogMSxcbiAgICBSSUdIVDogMixcbiAgICBVUDogMyxcbiAgICAvLyDljoblj7LnirbmgIHorrDlvZXvvIzkv53lrZjkuInmnaFcbiAgICBfaGlzdG9yeToge1xuICAgICAgICBtYXQ6IFtdLFxuICAgICAgICBzY29yZTogW10sXG4gICAgICAgIGJlc3Q6IFtdLFxuICAgIH0sXG4gICAgLy8g5LiK5LiA5q2l54q25oCB6K6w5b2VXG4gICAgX2xhc3Q6IHtcbiAgICAgICAgbWF0OiBbXSxcbiAgICAgICAgc2NvcmU6IDAsXG4gICAgICAgIGJlc3Q6IDAsXG4gICAgfSxcbiAgICBfc3RhcnRlZDogZmFsc2UsXG4gICAgX25vTmV3TnVtOiBmYWxzZSxcbiAgICBvblN0YXJ0OiBudWxsLFxuICAgIG9uTW92ZTogbnVsbCxcbiAgICBvbkVtZXJnZTogbnVsbCxcbiAgICBvbkdlbk5ld051bTogbnVsbCxcbiAgICBvblNjb3JlOiBudWxsLFxuICAgIG9uR2FtZU92ZXI6IG51bGwsXG59O1xuXG5mdW5jdGlvbiByZXNldChyZXNldEJlc3QpIHtcbiAgICBnYW1lLm1hdCA9IG51bGw7XG4gICAgZ2FtZS5lbXB0eVRpbGVzID0gW107XG4gICAgZ2FtZS5fc3RhcnRlZCA9IGZhbHNlO1xuICAgIGdhbWUuc2NvcmUgPSAwO1xuICAgIGlmIChyZXNldEJlc3QpIHtcbiAgICAgICAgZ2FtZS5iZXN0ID0gMDtcbiAgICB9XG4gICAgZ2FtZS5faGlzdG9yeSA9IHtcbiAgICAgICAgbWF0OiBbXSxcbiAgICAgICAgc2NvcmU6IFtdLFxuICAgICAgICBiZXN0OiBbXSxcbiAgICB9O1xuICAgIGdhbWUuX2xhc3QgPSB7XG4gICAgICAgIG1hdDogW10sXG4gICAgICAgIHNjb3JlOiAwLFxuICAgICAgICBiZXN0OiBnYW1lLmJlc3QsXG4gICAgfTtcbiAgICBnYW1lLl9ub05ld051bSA9IGZhbHNlO1xuXG4gICAgaWYgKGlzRnVuY3Rpb24oZ2FtZS5vblNjb3JlKSkge1xuICAgICAgICBnYW1lLm9uU2NvcmUoKTtcbiAgICB9XG59XG5cblxuZnVuY3Rpb24gaW5pdE1hdCgpIHtcbiAgICBnYW1lLm1hdCA9IGNyZWF0ZUZpbGxlZEFycigwLCAxNik7XG5cbiAgICB1cGRhdGVFbXB0eVRpbGVzKCk7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IDI7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgZ2VuTnVtSW5FbXB0eSgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gdXBkYXRlRW1wdHlUaWxlcygpIHtcbiAgICBnYW1lLmVtcHR5VGlsZXMgPSBbXTtcbiAgICBnYW1lLm1hdC5mb3JFYWNoKGZ1bmN0aW9uKHYsIGkpIHtcbiAgICAgICAgaWYgKHYgPT09IDApIHtcbiAgICAgICAgICAgIGdhbWUuZW1wdHlUaWxlcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGdlbk51bUluRW1wdHkocG9zKSB7XG4gICAgaWYoZ2FtZS5fbm9OZXdOdW0pIHJldHVybiBmYWxzZTtcbiAgICB1cGRhdGVFbXB0eVRpbGVzKCk7XG4gICAgdmFyIHBvc2l0aW9uO1xuICAgIGlmIChwb3MpIHtcbiAgICAgICAgcG9zaXRpb24gPSBwb3M7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHJhbmRpbnQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBnYW1lLmVtcHR5VGlsZXMubGVuZ3RoKTtcbiAgICAgICAgcG9zaXRpb24gPSBnYW1lLmVtcHR5VGlsZXNbcmFuZGludF07XG4gICAgfVxuICAgIHZhciBwb3NJbmRleCA9IGdhbWUuZW1wdHlUaWxlcy5pbmRleE9mKHBvc2l0aW9uKTtcbiAgICBpZiAoZ2FtZS5tYXRbcG9zaXRpb25dIHx8IHBvc0luZGV4ID09PSAtMSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZ2FtZS5tYXRbcG9zaXRpb25dID0gY2hvaWNlKFsyLCA0XSk7XG4gICAgaWYgKGlzRnVuY3Rpb24oZ2FtZS5vbkdlbk5ld051bSkpIHtcbiAgICAgICAgZ2FtZS5vbkdlbk5ld051bShnYW1lLm1hdFtwb3NpdGlvbl0sIHBvc2l0aW9uKTtcbiAgICB9XG4gICAgZ2FtZS5lbXB0eVRpbGVzLnNwbGljZShwb3NJbmRleCwgMSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbi8vIOW8gOWni+aWsOa4uOaIj1xuZnVuY3Rpb24gbmV3R2FtZShyZXNldEJlc3QpIHtcbiAgICByZXNldChyZXNldEJlc3QpO1xuICAgIGdhbWUuX3N0YXJ0ZWQgPSB0cnVlO1xuICAgIGluaXRNYXQoKTtcbiAgICBpZiAoaXNGdW5jdGlvbihnYW1lLm9uU3RhcnQpKSB7XG4gICAgICAgIGdhbWUub25TdGFydCgpO1xuICAgIH1cblxufVxuXG4vLyDlvpfliIZcbmZ1bmN0aW9uIHNjb3JlKHYpIHtcbiAgICBnYW1lLnNjb3JlICs9IHY7XG4gICAgZ2FtZS5iZXN0ID0gTWF0aC5tYXgoZ2FtZS5zY29yZSwgZ2FtZS5iZXN0KTtcbiAgICBpZiAoaXNGdW5jdGlvbihnYW1lLm9uU2NvcmUpKSB7XG4gICAgICAgIGdhbWUub25TY29yZSgpO1xuICAgIH1cblxufVxuXG4vLyDlj6rmnInlvZPmsqHmnInnqbrmoLzvvIzlubbkuJTku7vmhI/nm7jpgrvnmoTkuKTmoLzkuI3nm7jlkIzmiY3mmK9nYW1lT3ZlclxuZnVuY3Rpb24gaXNHYW1lT3ZlcigpIHtcbiAgICBpZiAoZ2FtZS5lbXB0eVRpbGVzLmxlbmd0aCA+IDApIHJldHVybiBmYWxzZTtcbiAgICAvLyDlr7nmr4/kuKrkvY3nva7lj6rmn6Xlj7PkuIvkuKTmoLzmmK/lkKbnm7jnrYlcbiAgICB2YXIgZmxhZyA9IHRydWU7XG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSAxNjsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoTWF0aC5mbG9vcihpIC8gNCkgPT09IDMpIHtcbiAgICAgICAgICAgIC8vIOacgOWQjuS4gOihjO+8jOacgOWQjuS4gOS4qlxuICAgICAgICAgICAgaWYgKGkgJSA0ID09PSAzKSBjb250aW51ZTtcbiAgICAgICAgICAgIGlmIChnYW1lLm1hdFtpXSA9PT0gZ2FtZS5tYXRbaSArIDFdKSB7XG4gICAgICAgICAgICAgICAgZmxhZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGkgJSA0ID09PSAzKSB7XG4gICAgICAgICAgICBpZiAoZ2FtZS5tYXRbaV0gPT09IGdhbWUubWF0W2kgKyA0XSkge1xuICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChnYW1lLm1hdFtpXSA9PT0gZ2FtZS5tYXRbaSArIDFdIHx8IGdhbWUubWF0W2ldID09PSBnYW1lLm1hdFtpICsgNF0pIHtcbiAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICB9XG4gICAgcmV0dXJuIGZsYWc7XG59XG5cblxuLy8g5ri45oiP57uT5p2fXG5mdW5jdGlvbiBnYW1lT3ZlcigpIHtcbiAgICAvLyByZXNldCgpO1xuICAgIGdhbWUuX3N0YXJ0ZWQgPSBmYWxzZTtcbiAgICBpZiAoaXNGdW5jdGlvbihnYW1lLm9uR2FtZU92ZXIpKSB7XG4gICAgICAgIGdhbWUub25HYW1lT3ZlcigpO1xuICAgIH1cbn1cblxuLy8g5Zue5pKk5LiJ5q2lXG5mdW5jdGlvbiB1bmRvKCkge1xuICAgIGlmICghZ2FtZS5fc3RhcnRlZCkgcmV0dXJuIGZhbHNlO1xuICAgIHZhciBoaXN0b3J5ID0gZ2FtZS5faGlzdG9yeTtcbiAgICBpZiAoIWhpc3RvcnkgfHwgaGlzdG9yeS5tYXQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZ2FtZS5tYXQgPSBoaXN0b3J5Lm1hdC5wb3AoKTtcbiAgICBnYW1lLnNjb3JlID0gaGlzdG9yeS5zY29yZS5wb3AoKTtcbiAgICBnYW1lLmJlc3QgPSBoaXN0b3J5LmJlc3QucG9wKCk7XG4gICAgaWYgKGlzRnVuY3Rpb24oZ2FtZS5vblNjb3JlKSkge1xuICAgICAgICBnYW1lLm9uU2NvcmUoKTtcbiAgICB9XG5cbiAgICB2YXIgbGFzdCA9IGdhbWUuX2xhc3Q7XG4gICAgbGFzdC5tYXQgPSBnYW1lLm1hdC5zbGljZSgpO1xuICAgIGxhc3Quc2NvcmUgPSBnYW1lLnNjb3JlO1xuICAgIGxhc3QuYmVzdCA9IGdhbWUuYmVzdDtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuLy8g6K6w5b2V54q25oCB77yM55So5LqOdW5kb1xuZnVuY3Rpb24gcmVjb3JkKCkge1xuICAgIHZhciBsYXN0ID0gZ2FtZS5fbGFzdDtcbiAgICB2YXIgaGlzdCA9IGdhbWUuX2hpc3Rvcnk7XG4gICAgLy8gcmVtZW1iZXIgaW50byBoaXN0b3J5XG4gICAgaWYgKGxhc3QubWF0Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgICBoaXN0Lm1hdC5wdXNoKGxhc3QubWF0LnNsaWNlKCkpO1xuICAgICAgICBoaXN0LnNjb3JlLnB1c2gobGFzdC5zY29yZSk7XG4gICAgICAgIGhpc3QuYmVzdC5wdXNoKGxhc3QuYmVzdCk7XG4gICAgfVxuICAgIGlmIChoaXN0Lm1hdC5sZW5ndGggPiAzKSB7XG4gICAgICAgIGhpc3QubWF0LnNoaWZ0KCk7XG4gICAgICAgIGhpc3Quc2NvcmUuc2hpZnQoKTtcbiAgICAgICAgaGlzdC5iZXN0LnNoaWZ0KCk7XG4gICAgfVxuICAgIC8vIHJlY29yZCB0aGlzIHN0ZXBcbiAgICBsYXN0Lm1hdCA9IGdhbWUubWF0LnNsaWNlKCk7XG4gICAgbGFzdC5zY29yZSA9IGdhbWUuc2NvcmU7XG4gICAgbGFzdC5iZXN0ID0gZ2FtZS5iZXN0O1xufVxuXG5mdW5jdGlvbiBtb3ZlKGRpcmVjdGlvbikge1xuICAgIGlmICghZ2FtZS5fc3RhcnRlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBsYXN0ID0gZ2FtZS5tYXQuc2xpY2UoKTtcblxuICAgIC8vIOWFiOenu+WKqOWGjeWIpOaWreaYr+WQpuacieaViOenu+WKqOaIluiAhUdBTUUgT1ZFUlxuICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgZ2FtZS5SSUdIVDpcbiAgICAgICAgICAgIGNsb2Nrd2lzZVRyYW5zZm9ybShnYW1lLm1hdCk7XG4gICAgICAgICAgICBjbG9ja3dpc2VUcmFuc2Zvcm0oZ2FtZS5tYXQpO1xuICAgICAgICAgICAgbWVyZ2VUb0xlZnQoZ2FtZS5tYXQsIG9uTW92ZSwgb25FbWVyZ2UpO1xuICAgICAgICAgICAgY2xvY2t3aXNlVHJhbnNmb3JtKGdhbWUubWF0KTtcbiAgICAgICAgICAgIGNsb2Nrd2lzZVRyYW5zZm9ybShnYW1lLm1hdCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBnYW1lLlVQOlxuICAgICAgICAgICAgY2xvY2t3aXNlVHJhbnNmb3JtKGdhbWUubWF0LCB0cnVlKTtcbiAgICAgICAgICAgIG1lcmdlVG9MZWZ0KGdhbWUubWF0LCBvbk1vdmUsIG9uRW1lcmdlKTtcbiAgICAgICAgICAgIGNsb2Nrd2lzZVRyYW5zZm9ybShnYW1lLm1hdCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBnYW1lLkRPV046XG4gICAgICAgICAgICBjbG9ja3dpc2VUcmFuc2Zvcm0oZ2FtZS5tYXQpO1xuICAgICAgICAgICAgbWVyZ2VUb0xlZnQoZ2FtZS5tYXQsIG9uTW92ZSwgb25FbWVyZ2UpO1xuICAgICAgICAgICAgY2xvY2t3aXNlVHJhbnNmb3JtKGdhbWUubWF0LCB0cnVlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIGdhbWUuTEVGVDpcbiAgICAgICAgICAgIG1lcmdlVG9MZWZ0KGdhbWUubWF0LCBvbk1vdmUsIG9uRW1lcmdlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIOmmluWFiOajgOafpeaYr+WQpuacieaViOenu+WKqFxuICAgIGlmIChsYXN0LnRvU3RyaW5nKCkgPT09IGdhbWUubWF0LnRvU3RyaW5nKCkpIHtcbiAgICAgICAgLy8g54S25ZCO5qOA5p+lZW1wdHlUaWxlc+i/mOacieayoeacieWFg+e0oFxuICAgICAgICBpZiAoaXNHYW1lT3ZlcigpKSB7XG4gICAgICAgICAgICAvLyDml6DnqbrmoLzlsLFnYW1lT3ZlclxuICAgICAgICAgICAgZ2FtZU92ZXIoKTtcbiAgICAgICAgfVxuICAgICAgICAgICAgLy8g5peg5pWI56e75Yqo5LiN5YGa5Lu75L2V5LqL44CCXG4gICAgfSBlbHNlIHtcbiAgICAgICAgZ2VuTnVtSW5FbXB0eSgpO1xuICAgICAgICByZWNvcmQoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbk1vdmUodiwgbmV3UG9zLCBsYXN0UG9zKSB7XG4gICAgICAgIGlmIChpc0Z1bmN0aW9uKGdhbWUub25Nb3ZlKSkge1xuICAgICAgICAgICAgZ2FtZS5vbk1vdmUodiwgZ2V0T3JpZ2luSW5kZXgoZGlyZWN0aW9uLCBuZXdQb3MpLCBnZXRPcmlnaW5JbmRleChkaXJlY3Rpb24sIGxhc3RQb3MpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uRW1lcmdlKHYsIG5ld1BvcywgbGFzdFBvcykge1xuICAgICAgICBpZiAoaXNGdW5jdGlvbihnYW1lLm9uRW1lcmdlKSkge1xuICAgICAgICAgICAgZ2FtZS5vbkVtZXJnZSh2LCBnZXRPcmlnaW5JbmRleChkaXJlY3Rpb24sIG5ld1BvcyksIGdldE9yaWdpbkluZGV4KGRpcmVjdGlvbiwgbGFzdFBvcykpO1xuICAgICAgICB9XG4gICAgfVxuXG59XG5cbi8vIOWQiOW5tuagvOWtkFxuZnVuY3Rpb24gbWVyZ2VUb0xlZnQobWF0cml4LCBvbk1vdmUsIG9uRW1lcmdlKSB7XG4gICAgdmFyIGJsb2NrID0gMDtcbiAgICB2YXIgbWVyZ2VUb05leHQgPSBmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICBpZiAoaSAlIDQgPT09IDAgfHwgdiA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtYXRyaXhbaSAtIDFdID09PSAwKSB7XG4gICAgICAgICAgICBtYXRyaXhbaSAtIDFdID0gdjtcbiAgICAgICAgICAgIG1hdHJpeFtpXSA9IDA7XG4gICAgICAgICAgICAvLyDnp7vliqjlkI7nmoTlm57osINcbiAgICAgICAgICAgIC8vIOeUseS6jui9rOe9rui/h++8jOWvvOiHtOe0ouW8leS4jeWvue+8jOWboOatpOimgei9rOe9ruWbnuWOu1xuICAgICAgICAgICAgLy8gWFhYOiDlupTor6XmnInmm7Tlpb3nmoTlpITnkIbmlrnms5VcbiAgICAgICAgICAgIG9uTW92ZSh2LCBpIC0gMSwgaSk7XG4gICAgICAgICAgICByZXR1cm4gbWVyZ2VUb05leHQodiwgaSAtIDEpO1xuICAgICAgICB9IGVsc2UgaWYgKGkgPT09IGJsb2NrKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSBpZiAobWF0cml4W2kgLSAxXSA9PT0gdikge1xuICAgICAgICAgICAgbWF0cml4W2kgLSAxXSArPSB2O1xuICAgICAgICAgICAgbWF0cml4W2ldID0gMDtcbiAgICAgICAgICAgIC8vIOmBv+WFjeS4gOasoeenu+WKqOS4reWQjOS4gOagvOWkmuasoeWQiOW5tlxuICAgICAgICAgICAgYmxvY2sgPSBpO1xuICAgICAgICAgICAgLy8g5ZCI5bm255qE5Zue6LCDXG4gICAgICAgICAgICBvbkVtZXJnZShtYXRyaXhbaSAtIDFdLCBpIC0gMSwgaSk7XG4gICAgICAgICAgICBzY29yZShtYXRyaXhbaSAtIDFdKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBtYXRyaXguZm9yRWFjaChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICBtZXJnZVRvTmV4dCh2LCBpKTtcbiAgICB9KTtcblxufVxuXG4vLyDnlLHovaznva7lkI7nmoTntKLlvJXmmKDlsITliLDljp/mnKznmoTntKLlvJVcbmZ1bmN0aW9uIGdldE9yaWdpbkluZGV4KGNsb2Nrd2lzZVRpbWVzLCBpbmRleCkge1xuICAgIHZhciBwb3MsIGxhc3RJbmRleCA9IGluZGV4O1xuICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2xvY2t3aXNlVGltZXM7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgcG9zID0gaW5kZXgyUm93Q29sKGxhc3RJbmRleCk7XG4gICAgICAgIGxhc3RJbmRleCA9IHJvd0NvbDJJbmRleCgzIC0gcG9zLmNvbCwgcG9zLnJvdyk7XG4gICAgfVxuICAgIHJldHVybiBsYXN0SW5kZXg7XG59XG5cblxuZnVuY3Rpb24gY2xvY2t3aXNlVHJhbnNmb3JtKG1hdHJpeCwgcmV2ZXJzZSkge1xuICAgIHZhciB0ZW1wID0gbWF0cml4LnNsaWNlKCk7XG4gICAgaWYgKHJldmVyc2UpIHtcbiAgICAgICAgdGVtcC5mb3JFYWNoKCh2LCBpKT0+e1xuICAgICAgICAgICAgdmFyIHBvcyA9IGluZGV4MlJvd0NvbChpKSxcbiAgICAgICAgICAgICAgICBuZXdQb3MgPSByb3dDb2wySW5kZXgoMyAtIHBvcy5jb2wsIHBvcy5yb3cpO1xuICAgICAgICAgICAgbWF0cml4W25ld1Bvc10gPSB2O1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0ZW1wLmZvckVhY2goKHYsIGkpPT57XG4gICAgICAgICAgICB2YXIgcG9zID0gaW5kZXgyUm93Q29sKGkpLFxuICAgICAgICAgICAgICAgIG5ld1BvcyA9IHJvd0NvbDJJbmRleChwb3MuY29sLCAzIC0gcG9zLnJvdyk7XG4gICAgICAgICAgICBtYXRyaXhbbmV3UG9zXSA9IHY7XG4gICAgICAgIH0pO1xuICAgIH1cblxufVxuXG4vLyDkuIDnu7TmlbDnu4TnmoTntKLlvJXovazkuLrooYzliJdcbmZ1bmN0aW9uIGluZGV4MlJvd0NvbChpbmRleCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJvdzogTWF0aC5mbG9vcihpbmRleCAvIDQpLFxuICAgICAgICBjb2w6IGluZGV4ICUgNCxcbiAgICB9O1xufVxuXG4vLyDooYzliJfovazkuLrkuIDnu7TmlbDnu4TntKLlvJVcbmZ1bmN0aW9uIHJvd0NvbDJJbmRleChyb3csIGNvbCkge1xuICAgIHJldHVybiByb3cgKiA0ICsgY29sO1xufVxuXG4vLyDkvb/nlKjooYzliJfmnaXojrflj5bkuIDnu7TmlbDnu4TnmoTlgLxcbmZ1bmN0aW9uIGdldE1hdFZhbEJ5Um93Q29sKG1hdCwgcm93LCBjb2wpIHtcbiAgICB2YXIgaW5kZXggPSByb3dDb2wySW5kZXgocm93LCBjb2wpO1xuICAgIHJldHVybiBtYXRbaW5kZXhdO1xufVxuXG5cbi8vIGNvbnNvbGVcbmZ1bmN0aW9uIHByaW50KCkge1xuICAgIHZhciBzdHIgPSAnJztcbiAgICBnYW1lLm1hdC5mb3JFYWNoKGZ1bmN0aW9uICh2LCBpKSB7XG4gICAgICAgIHN0ciArPSAodiB8fCAwKSArICdcXHQnO1xuICAgICAgICBpZiAoaSAlIDQgPT09IDMpIHtcbiAgICAgICAgICAgIHN0ciArPSAnXFxuJztcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBzdHI7XG59XG5cbi8vIHV0aWxcbmZ1bmN0aW9uIGNyZWF0ZUZpbGxlZEFycihkYXRhLCBzaXplKSB7XG4gICAgdmFyIGFyciA9IFtdO1xuICAgIGFyci5sZW5ndGggPSBzaXplO1xuICAgIHJldHVybiBhcnIuam9pbignLCcpLnNwbGl0KCcsJykubWFwKCgpPT5kYXRhKTtcbn1cblxuZnVuY3Rpb24gY2hvaWNlKG9wdHMpIHtcbiAgICB2YXIgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKG9wdHMubGVuZ3RoICogTWF0aC5yYW5kb20oKSk7XG4gICAgcmV0dXJuIG9wdHNbcmFuZG9tSW5kZXhdO1xufVxuXG5mdW5jdGlvbiBpc0Z1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnZnVuY3Rpb24nO1xufVxuXG5cbmdhbWUubW92ZSA9IG1vdmU7XG5nYW1lLnByaW50ID0gcHJpbnQ7XG5nYW1lLmNyZWF0ZUZpbGxlZEFyciA9IGNyZWF0ZUZpbGxlZEFycjtcbmdhbWUuaW5kZXgyUm93Q29sID0gaW5kZXgyUm93Q29sO1xuZ2FtZS5yb3dDb2wySW5kZXggPSByb3dDb2wySW5kZXg7XG5nYW1lLmdldE1hdFZhbEJ5Um93Q29sID0gZ2V0TWF0VmFsQnlSb3dDb2w7XG5nYW1lLmdlbk51bUluRW1wdHkgPSBnZW5OdW1JbkVtcHR5O1xuZ2FtZS5uZXdHYW1lID0gbmV3R2FtZTtcbmdhbWUucmVzZXQgPSByZXNldDtcbmdhbWUudW5kbyA9IHVuZG87XG5nYW1lLmlzR2FtZU92ZXIgPSBpc0dhbWVPdmVyO1xuZ2FtZS5nYW1lT3ZlciA9IGdhbWVPdmVyO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGdhbWU7XG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL2FwcC9nYW1lLmpzIl0sInNvdXJjZVJvb3QiOiIifQ==")},function(module,exports){eval("// removed by extract-text-webpack-plugin//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvbWFpbi5sZXNzP2FmODYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEiLCJmaWxlIjoiMS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHJlbW92ZWQgYnkgZXh0cmFjdC10ZXh0LXdlYnBhY2stcGx1Z2luXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hcHAvbWFpbi5sZXNzXG4vLyBtb2R1bGUgaWQgPSAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=")},function(module,exports,__webpack_require__){"use strict";eval("\n\nvar _game = __webpack_require__(0);\n\nvar _game2 = _interopRequireDefault(_game);\n\n__webpack_require__(1);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// COOKIE 记录游戏状态\nfunction recordCookie() {\n    var status = {\n        mat: _game2.default.mat,\n        score: _game2.default.score,\n        best: _game2.default.best\n    };\n    document.cookie = 's=' + JSON.stringify(status);\n}\n\nfunction parseCookie() {\n    if (document.cookie.substring(0, 2) === 's=') {\n        var status = JSON.parse(document.cookie.substring(2));\n        _game2.default.mat = status.mat;\n        _game2.default.score = status.score;\n        _game2.default.best = status.best;\n        return true;\n    }\n    return false;\n}\n\nwindow.onload = function () {\n\n    var newGameBtn = document.getElementById('newGameBtn'),\n        undoBtn = document.getElementById('undoBtn'),\n        currentScore = document.getElementById('currentScore'),\n        bestScore = document.getElementById('bestScore'),\n        gameOverShade = document.querySelector('.game-over'),\n        gameOverModal = document.querySelector('.game-over-modal'),\n        tryAgainBtn = document.querySelector('.try-again'),\n        tileContainer = document.querySelector('.tile-container'),\n        gameBoard = document.querySelector('.gameboard');\n\n    newGameBtn.onclick = newGame;\n    undoBtn.onclick = undo;\n\n    _game2.default.onScore = function () {\n        currentScore.innerHTML = _game2.default.score;\n        bestScore.innerHTML = _game2.default.best;\n    };\n\n    _game2.default.onGameOver = function () {\n        showModal();\n        tryAgainBtn.onclick = function () {\n            newGame();\n            hideModal();\n        };\n    };\n    function showModal() {\n        gameOverShade.style.display = 'block';\n        gameOverModal.className += ' slide-in';\n    }\n    function hideModal() {\n        gameOverShade.style.display = 'none';\n        gameOverModal.className = 'game-over-modal';\n    }\n\n    // 监听按键\n    document.onkeydown = function (e) {\n        var move = [37, 38, 39, 40];\n        if (move.indexOf(e.keyCode) !== -1) {\n            var action = {\n                37: function _() {\n                    _game2.default.move(_game2.default.LEFT);\n                },\n                38: function _() {\n                    _game2.default.move(_game2.default.UP);\n                },\n                39: function _() {\n                    _game2.default.move(_game2.default.RIGHT);\n                },\n                40: function _() {\n                    _game2.default.move(_game2.default.DOWN);\n                }\n            };\n            action[e.keyCode]();\n            e.preventDefault();\n            // e.stopPropagation();\n            // e.returnValue = false;\n            recordCookie();\n        }\n    };\n\n    // 监听滑动\n    var touchStartClientX, touchStartClientY, touchEndClientX, touchEndClientY;\n    gameBoard.addEventListener('touchstart', function (e) {\n        // e.preventDefault();\n        if (event.targetTouches.length > 1) return; // 多于1个手指控制\n        touchStartClientX = e.touches[0].clientX;\n        touchStartClientY = e.touches[0].clientY;\n    });\n    gameBoard.addEventListener('touchmove', function (e) {\n        e.preventDefault();\n    });\n    gameBoard.addEventListener('touchend', function (e) {\n        if (event.targetTouches.length > 0) return; // 持续滑动\n        touchEndClientX = event.changedTouches[0].clientX;\n        touchEndClientY = event.changedTouches[0].clientY;\n        var dx = touchEndClientX - touchStartClientX;\n        var absDx = Math.abs(dx);\n        var dy = touchEndClientY - touchStartClientY;\n        var absDy = Math.abs(dy);\n        if (Math.max(absDx, absDy) > 10) {\n            if (absDx > absDy) {\n                if (dx > 0) _game2.default.move(_game2.default.RIGHT);else _game2.default.move(_game2.default.LEFT);\n            } else if (dy > 0) _game2.default.move(_game2.default.DOWN);else _game2.default.move(_game2.default.UP);\n        }\n    });\n\n    _game2.default.onStart = function () {\n        recordCookie();\n    };\n    _game2.default.onMove = function (v, newPos, lastPos) {\n        var tile = getTile(lastPos);\n        if (tile) {\n            tile.className = getTileClassName(v, newPos);\n        }\n    };\n\n    _game2.default.onEmerge = function (v, posIndex, removedPosIndex) {\n        var removedTile = getTile(removedPosIndex);\n        // 一定要在改className之前找到元素\n        var emergedTile = getTile(posIndex);\n        removedTile.className = getTileClassName(v, posIndex) + ' hide';\n        setTimeout(function () {\n            // 为了让动画完成\n            tileContainer.removeChild(removedTile);\n        }, 100);\n        emergedTile.innerHTML = v;\n        emergedTile.className = getTileClassName(v, posIndex);\n    };\n    _game2.default.onGenNewNum = function (v, posIndex) {\n        var tile = createTile(v, posIndex);\n        tile.className += ' fade-in';\n        tileContainer.appendChild(tile);\n    };\n\n    if (parseCookie()) {\n        resetTile();\n    }\n\n    function newGame() {\n        hideModal();\n        // 移动如何改变tile\n        tileContainer.innerHTML = '';\n        _game2.default.newGame();\n    }\n    function getTileClassName(value, pos) {\n        return ['tile', 'tile-' + value, getColorClassName(value), getPosClassName(pos)].join(' ');\n    }\n\n    function getPosClassName(pos) {\n        var posObj = _game2.default.index2RowCol(pos);\n        return 'tile-pos-' + posObj.row + '-' + posObj.col;\n    }\n    function getColorClassName(value) {\n        return 'tile-color-' + value;\n    }\n\n    function createTile(value, posIndex) {\n        var tile = document.createElement('div');\n        tile.className = getTileClassName(value, posIndex);\n        tile.innerHTML = value;\n        return tile;\n    }\n\n    function getTile(pos) {\n        var className = getPosClassName(pos);\n        return document.querySelector('.' + className);\n    }\n\n    function undo() {\n        if (_game2.default.undo()) {\n            resetTile();\n        }\n    }\n\n    function resetTile() {\n        _game2.default._started = true;\n        tileContainer.innerHTML = '';\n        var fragment = document.createDocumentFragment();\n        _game2.default.mat.forEach(function (v, i) {\n            if (v !== 0) {\n                fragment.appendChild(createTile(v, i));\n            }\n        });\n        tileContainer.appendChild(fragment);\n        _game2.default.onScore();\n    }\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvbWFpbi5qcz82YTRiIl0sIm5hbWVzIjpbInJlY29yZENvb2tpZSIsInN0YXR1cyIsIm1hdCIsInNjb3JlIiwiYmVzdCIsImRvY3VtZW50IiwiY29va2llIiwiSlNPTiIsInN0cmluZ2lmeSIsInBhcnNlQ29va2llIiwic3Vic3RyaW5nIiwicGFyc2UiLCJ3aW5kb3ciLCJvbmxvYWQiLCJuZXdHYW1lQnRuIiwiZ2V0RWxlbWVudEJ5SWQiLCJ1bmRvQnRuIiwiY3VycmVudFNjb3JlIiwiYmVzdFNjb3JlIiwiZ2FtZU92ZXJTaGFkZSIsInF1ZXJ5U2VsZWN0b3IiLCJnYW1lT3Zlck1vZGFsIiwidHJ5QWdhaW5CdG4iLCJ0aWxlQ29udGFpbmVyIiwiZ2FtZUJvYXJkIiwib25jbGljayIsIm5ld0dhbWUiLCJ1bmRvIiwib25TY29yZSIsImlubmVySFRNTCIsIm9uR2FtZU92ZXIiLCJzaG93TW9kYWwiLCJoaWRlTW9kYWwiLCJzdHlsZSIsImRpc3BsYXkiLCJjbGFzc05hbWUiLCJvbmtleWRvd24iLCJlIiwibW92ZSIsImluZGV4T2YiLCJrZXlDb2RlIiwiYWN0aW9uIiwiTEVGVCIsIlVQIiwiUklHSFQiLCJET1dOIiwicHJldmVudERlZmF1bHQiLCJ0b3VjaFN0YXJ0Q2xpZW50WCIsInRvdWNoU3RhcnRDbGllbnRZIiwidG91Y2hFbmRDbGllbnRYIiwidG91Y2hFbmRDbGllbnRZIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwidGFyZ2V0VG91Y2hlcyIsImxlbmd0aCIsInRvdWNoZXMiLCJjbGllbnRYIiwiY2xpZW50WSIsImNoYW5nZWRUb3VjaGVzIiwiZHgiLCJhYnNEeCIsIk1hdGgiLCJhYnMiLCJkeSIsImFic0R5IiwibWF4Iiwib25TdGFydCIsIm9uTW92ZSIsInYiLCJuZXdQb3MiLCJsYXN0UG9zIiwidGlsZSIsImdldFRpbGUiLCJnZXRUaWxlQ2xhc3NOYW1lIiwib25FbWVyZ2UiLCJwb3NJbmRleCIsInJlbW92ZWRQb3NJbmRleCIsInJlbW92ZWRUaWxlIiwiZW1lcmdlZFRpbGUiLCJzZXRUaW1lb3V0IiwicmVtb3ZlQ2hpbGQiLCJvbkdlbk5ld051bSIsImNyZWF0ZVRpbGUiLCJhcHBlbmRDaGlsZCIsInJlc2V0VGlsZSIsInZhbHVlIiwicG9zIiwiZ2V0Q29sb3JDbGFzc05hbWUiLCJnZXRQb3NDbGFzc05hbWUiLCJqb2luIiwicG9zT2JqIiwiaW5kZXgyUm93Q29sIiwicm93IiwiY29sIiwiY3JlYXRlRWxlbWVudCIsIl9zdGFydGVkIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiZm9yRWFjaCIsImkiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7QUFDQTs7OztBQUVBO0FBQ0EsU0FBU0EsWUFBVCxHQUF3QjtBQUNwQixRQUFJQyxTQUFTO0FBQ1RDLGFBQUssZUFBS0EsR0FERDtBQUVUQyxlQUFPLGVBQUtBLEtBRkg7QUFHVEMsY0FBTSxlQUFLQTtBQUhGLEtBQWI7QUFLQUMsYUFBU0MsTUFBVCxHQUFrQixPQUFPQyxLQUFLQyxTQUFMLENBQWVQLE1BQWYsQ0FBekI7QUFDSDs7QUFFRCxTQUFTUSxXQUFULEdBQXVCO0FBQ25CLFFBQUlKLFNBQVNDLE1BQVQsQ0FBZ0JJLFNBQWhCLENBQTBCLENBQTFCLEVBQTZCLENBQTdCLE1BQW9DLElBQXhDLEVBQThDO0FBQzFDLFlBQUlULFNBQVNNLEtBQUtJLEtBQUwsQ0FBV04sU0FBU0MsTUFBVCxDQUFnQkksU0FBaEIsQ0FBMEIsQ0FBMUIsQ0FBWCxDQUFiO0FBQ0EsdUJBQUtSLEdBQUwsR0FBV0QsT0FBT0MsR0FBbEI7QUFDQSx1QkFBS0MsS0FBTCxHQUFhRixPQUFPRSxLQUFwQjtBQUNBLHVCQUFLQyxJQUFMLEdBQVlILE9BQU9HLElBQW5CO0FBQ0EsZUFBTyxJQUFQO0FBQ0g7QUFDRCxXQUFPLEtBQVA7QUFFSDs7QUFHRFEsT0FBT0MsTUFBUCxHQUFnQixZQUFXOztBQUd2QixRQUFJQyxhQUFhVCxTQUFTVSxjQUFULENBQXdCLFlBQXhCLENBQWpC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dXJjZXNDb250ZW50IjpbImltcG9ydCBnYW1lIGZyb20gJy4vZ2FtZS5qcyc7XG5pbXBvcnQgJy4vbWFpbi5sZXNzJztcblxuLy8gQ09PS0lFIOiusOW9lea4uOaIj+eKtuaAgVxuZnVuY3Rpb24gcmVjb3JkQ29va2llKCkge1xuICAgIHZhciBzdGF0dXMgPSB7XG4gICAgICAgIG1hdDogZ2FtZS5tYXQsXG4gICAgICAgIHNjb3JlOiBnYW1lLnNjb3JlLFxuICAgICAgICBiZXN0OiBnYW1lLmJlc3QsXG4gICAgfTtcbiAgICBkb2N1bWVudC5jb29raWUgPSAncz0nICsgSlNPTi5zdHJpbmdpZnkoc3RhdHVzKTtcbn1cblxuZnVuY3Rpb24gcGFyc2VDb29raWUoKSB7XG4gICAgaWYgKGRvY3VtZW50LmNvb2tpZS5zdWJzdHJpbmcoMCwgMikgPT09ICdzPScpIHtcbiAgICAgICAgdmFyIHN0YXR1cyA9IEpTT04ucGFyc2UoZG9jdW1lbnQuY29va2llLnN1YnN0cmluZygyKSk7XG4gICAgICAgIGdhbWUubWF0ID0gc3RhdHVzLm1hdDtcbiAgICAgICAgZ2FtZS5zY29yZSA9IHN0YXR1cy5zY29yZTtcbiAgICAgICAgZ2FtZS5iZXN0ID0gc3RhdHVzLmJlc3Q7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG5cbn1cblxuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7XG5cblxuICAgIHZhciBuZXdHYW1lQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ld0dhbWVCdG4nKSxcbiAgICAgICAgdW5kb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1bmRvQnRuJyksXG4gICAgICAgIGN1cnJlbnRTY29yZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXJyZW50U2NvcmUnKSxcbiAgICAgICAgYmVzdFNjb3JlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jlc3RTY29yZScpLFxuICAgICAgICBnYW1lT3ZlclNoYWRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWUtb3ZlcicpLFxuICAgICAgICBnYW1lT3Zlck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWUtb3Zlci1tb2RhbCcpLFxuICAgICAgICB0cnlBZ2FpbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50cnktYWdhaW4nKSxcbiAgICAgICAgdGlsZUNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aWxlLWNvbnRhaW5lcicpLFxuICAgICAgICBnYW1lQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FtZWJvYXJkJyk7XG5cblxuICAgIG5ld0dhbWVCdG4ub25jbGljayA9IG5ld0dhbWU7XG4gICAgdW5kb0J0bi5vbmNsaWNrID0gdW5kbztcblxuICAgIGdhbWUub25TY29yZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjdXJyZW50U2NvcmUuaW5uZXJIVE1MID0gZ2FtZS5zY29yZTtcbiAgICAgICAgYmVzdFNjb3JlLmlubmVySFRNTCA9IGdhbWUuYmVzdDtcbiAgICB9O1xuXG4gICAgZ2FtZS5vbkdhbWVPdmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHNob3dNb2RhbCgpO1xuICAgICAgICB0cnlBZ2FpbkJ0bi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuZXdHYW1lKCk7XG4gICAgICAgICAgICBoaWRlTW9kYWwoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGZ1bmN0aW9uIHNob3dNb2RhbCgpIHtcbiAgICAgICAgZ2FtZU92ZXJTaGFkZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgZ2FtZU92ZXJNb2RhbC5jbGFzc05hbWUgKz0gJyBzbGlkZS1pbic7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhpZGVNb2RhbCgpIHtcbiAgICAgICAgZ2FtZU92ZXJTaGFkZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBnYW1lT3Zlck1vZGFsLmNsYXNzTmFtZSA9ICdnYW1lLW92ZXItbW9kYWwnO1xuICAgIH1cblxuXG4gICAgLy8g55uR5ZCs5oyJ6ZSuXG4gICAgZG9jdW1lbnQub25rZXlkb3duID0gZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgbW92ZSA9IFszNywgMzgsIDM5LCA0MF07XG4gICAgICAgIGlmIChtb3ZlLmluZGV4T2YoZS5rZXlDb2RlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHZhciBhY3Rpb24gPSB7XG4gICAgICAgICAgICAgICAgMzc6ICgpPT57XG4gICAgICAgICAgICAgICAgICAgIGdhbWUubW92ZShnYW1lLkxFRlQpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgMzg6ICgpPT57XG4gICAgICAgICAgICAgICAgICAgIGdhbWUubW92ZShnYW1lLlVQKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIDM5OiAoKT0+e1xuICAgICAgICAgICAgICAgICAgICBnYW1lLm1vdmUoZ2FtZS5SSUdIVCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICA0MDogKCk9PntcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5tb3ZlKGdhbWUuRE9XTik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhY3Rpb25bZS5rZXlDb2RlXSgpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgLy8gZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIC8vIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgIHJlY29yZENvb2tpZSgpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIOebkeWQrOa7keWKqFxuICAgIHZhciB0b3VjaFN0YXJ0Q2xpZW50WCwgdG91Y2hTdGFydENsaWVudFksIHRvdWNoRW5kQ2xpZW50WCwgdG91Y2hFbmRDbGllbnRZO1xuICAgIGdhbWVCb2FyZC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSkge1xuICAgICAgICAvLyBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmIChldmVudC50YXJnZXRUb3VjaGVzLmxlbmd0aCA+IDEpIHJldHVybjsgLy8g5aSa5LqOMeS4quaJi+aMh+aOp+WItlxuICAgICAgICB0b3VjaFN0YXJ0Q2xpZW50WCA9IGUudG91Y2hlc1swXS5jbGllbnRYO1xuICAgICAgICB0b3VjaFN0YXJ0Q2xpZW50WSA9IGUudG91Y2hlc1swXS5jbGllbnRZO1xuICAgIH0pO1xuICAgIGdhbWVCb2FyZC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcbiAgICBnYW1lQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChldmVudC50YXJnZXRUb3VjaGVzLmxlbmd0aCA+IDApIHJldHVybjsgLy8g5oyB57ut5ruR5YqoXG4gICAgICAgIHRvdWNoRW5kQ2xpZW50WCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFg7XG4gICAgICAgIHRvdWNoRW5kQ2xpZW50WSA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFk7XG4gICAgICAgIHZhciBkeCA9IHRvdWNoRW5kQ2xpZW50WCAtIHRvdWNoU3RhcnRDbGllbnRYO1xuICAgICAgICB2YXIgYWJzRHggPSBNYXRoLmFicyhkeCk7XG4gICAgICAgIHZhciBkeSA9IHRvdWNoRW5kQ2xpZW50WSAtIHRvdWNoU3RhcnRDbGllbnRZO1xuICAgICAgICB2YXIgYWJzRHkgPSBNYXRoLmFicyhkeSk7XG4gICAgICAgIGlmIChNYXRoLm1heChhYnNEeCwgYWJzRHkpID4gMTApIHtcbiAgICAgICAgICAgIGlmIChhYnNEeCA+IGFic0R5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGR4ID4gMCkgZ2FtZS5tb3ZlKGdhbWUuUklHSFQpO1xuICAgICAgICAgICAgICAgIGVsc2UgZ2FtZS5tb3ZlKGdhbWUuTEVGVCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGR5ID4gMCkgZ2FtZS5tb3ZlKGdhbWUuRE9XTik7XG4gICAgICAgICAgICBlbHNlIGdhbWUubW92ZShnYW1lLlVQKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZ2FtZS5vblN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlY29yZENvb2tpZSgpO1xuICAgIH07XG4gICAgZ2FtZS5vbk1vdmUgPSBmdW5jdGlvbih2LCBuZXdQb3MsIGxhc3RQb3MpIHtcbiAgICAgICAgdmFyIHRpbGUgPSBnZXRUaWxlKGxhc3RQb3MpO1xuICAgICAgICBpZiAodGlsZSkge1xuICAgICAgICAgICAgdGlsZS5jbGFzc05hbWUgPSBnZXRUaWxlQ2xhc3NOYW1lKHYsIG5ld1Bvcyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgZ2FtZS5vbkVtZXJnZSA9IGZ1bmN0aW9uKHYsIHBvc0luZGV4LCByZW1vdmVkUG9zSW5kZXgpIHtcbiAgICAgICAgdmFyIHJlbW92ZWRUaWxlID0gZ2V0VGlsZShyZW1vdmVkUG9zSW5kZXgpO1xuICAgICAgICAvLyDkuIDlrpropoHlnKjmlLljbGFzc05hbWXkuYvliY3mib7liLDlhYPntKBcbiAgICAgICAgdmFyIGVtZXJnZWRUaWxlID0gZ2V0VGlsZShwb3NJbmRleCk7XG4gICAgICAgIHJlbW92ZWRUaWxlLmNsYXNzTmFtZSA9IGdldFRpbGVDbGFzc05hbWUodiwgcG9zSW5kZXgpICsgJyBoaWRlJztcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgLy8g5Li65LqG6K6p5Yqo55S75a6M5oiQXG4gICAgICAgICAgICB0aWxlQ29udGFpbmVyLnJlbW92ZUNoaWxkKHJlbW92ZWRUaWxlKTtcbiAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgZW1lcmdlZFRpbGUuaW5uZXJIVE1MID0gdjtcbiAgICAgICAgZW1lcmdlZFRpbGUuY2xhc3NOYW1lID0gZ2V0VGlsZUNsYXNzTmFtZSh2LCBwb3NJbmRleCk7XG4gICAgfTtcbiAgICBnYW1lLm9uR2VuTmV3TnVtID0gZnVuY3Rpb24odiwgcG9zSW5kZXgpIHtcbiAgICAgICAgdmFyIHRpbGUgPSBjcmVhdGVUaWxlKHYsIHBvc0luZGV4KTtcbiAgICAgICAgdGlsZS5jbGFzc05hbWUgKz0gJyBmYWRlLWluJztcbiAgICAgICAgdGlsZUNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aWxlKTtcbiAgICB9O1xuXG4gICAgaWYgKHBhcnNlQ29va2llKCkpIHtcbiAgICAgICAgcmVzZXRUaWxlKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbmV3R2FtZSgpIHtcbiAgICAgICAgaGlkZU1vZGFsKCk7XG4gICAgICAgIC8vIOenu+WKqOWmguS9leaUueWPmHRpbGVcbiAgICAgICAgdGlsZUNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgZ2FtZS5uZXdHYW1lKCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldFRpbGVDbGFzc05hbWUodmFsdWUsIHBvcykge1xuICAgICAgICByZXR1cm4gWyd0aWxlJywgJ3RpbGUtJyArIHZhbHVlLCBnZXRDb2xvckNsYXNzTmFtZSh2YWx1ZSksIGdldFBvc0NsYXNzTmFtZShwb3MpXS5qb2luKCcgJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0UG9zQ2xhc3NOYW1lKHBvcykge1xuICAgICAgICB2YXIgcG9zT2JqID0gZ2FtZS5pbmRleDJSb3dDb2wocG9zKTtcbiAgICAgICAgcmV0dXJuICd0aWxlLXBvcy0nICsgcG9zT2JqLnJvdyArICctJyArIHBvc09iai5jb2w7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldENvbG9yQ2xhc3NOYW1lKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiAndGlsZS1jb2xvci0nICsgdmFsdWU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlVGlsZSh2YWx1ZSwgcG9zSW5kZXgpIHtcbiAgICAgICAgdmFyIHRpbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGlsZS5jbGFzc05hbWUgPSBnZXRUaWxlQ2xhc3NOYW1lKHZhbHVlLCBwb3NJbmRleCk7XG4gICAgICAgIHRpbGUuaW5uZXJIVE1MID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0aWxlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFRpbGUocG9zKSB7XG4gICAgICAgIHZhciBjbGFzc05hbWUgPSBnZXRQb3NDbGFzc05hbWUocG9zKTtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgY2xhc3NOYW1lKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1bmRvKCkge1xuICAgICAgICBpZiAoZ2FtZS51bmRvKCkpIHtcbiAgICAgICAgICAgIHJlc2V0VGlsZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVzZXRUaWxlKCkge1xuICAgICAgICBnYW1lLl9zdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgdGlsZUNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICBnYW1lLm1hdC5mb3JFYWNoKCh2LCBpKT0+e1xuICAgICAgICAgICAgaWYgKHYgIT09IDApIHtcbiAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChjcmVhdGVUaWxlKHYsIGkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRpbGVDb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuICAgICAgICBnYW1lLm9uU2NvcmUoKTtcbiAgICB9XG59O1xuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL2FwcC9tYWluLmpzIl0sInNvdXJjZVJvb3QiOiIifQ==")}]);